<div class="jumbotron">
  <div class="container">
    <div class="page-content col-md-10 col-md-offset-1">

      <h2 ng-cloak>
        <h2><i class="glyphicon glyphicon-book"></i>
        <a href="#/{{username}}">{{username}}</a> /
        <span class="dropdown" ng-cloak>
          <a href="" class="dropdown-toggle" data-toggle="dropdown">
            <span ng-dblclick="editDeck(true)" ng-hide="isEditing" >{{deck.name}}</span>
            <input type="text" ng-model="deck.name" ng-show="isEditing" card-blur="editDeck(false)"></input>
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li ng-repeat="(id, d) in decks"><a href="#/{{username}}/{{id}}">{{d.name}}</a></li>
          </ul>
        </span>

        <div class="btn-toolbar pull-right" ng-show="isOwner">
          <div class="btn-group dropdown">
            <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-wrench"></i> <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="" ng-click="clearCards()">Clear</a></li>
              <li><a href="" ng-click="resetCards()">Reset</a></li>
              <li><a href="" ng-click="copyCards()" ng-show="user.username != username">Copy</a></li>
            </ul>
          </div>
        </div>

      </h2>
    </div>
  </div>
</div>

<div class="container">

  <div class="page-content col-md-10 col-md-offset-1">

    <div class="statsBox">
      <div class="row" ng-cloak>
        <div class="col-md-12 text-center">
          <a class="col-md-3 btn btn-link" ng-model="filter" btn-radio="2"><b>{{(cards | statusFilter:2).length}}</b> done</a>
          <a class="col-md-3 btn btn-link" ng-model="filter" btn-radio="1"><b>{{(cards | statusFilter:1).length}}</b> due</a>
          <a class="col-md-3 btn btn-link" ng-model="filter" btn-radio="0"><b>{{(cards | statusFilter:0).length}}</b> new</a>
          <a class="col-md-3 btn btn-link" ng-model="filter" btn-radio="-1"><b>{{cards.length}}</b> total</a>
        </div>
      </div>
      <div class="progress">
        <div class="progress-bar progress-bar-success" role="progressbar" style="width: {{((deck.cards | statusFilter:2).length)/(deck.cards.length)*100}}%;" tooltip="{{(deck.cards | statusFilter:2).length}} done">
          <span class="sr-only">{{(deck.cards | statusFilter:2).length}} done</span>
        </div>
        <div class="progress-bar progress-bar-danger" role="progressbar" style="width: {{((deck.cards | statusFilter:1).length)/(deck.cards.length)*100}}%;" tooltip="{{(deck.cards | statusFilter:1).length}} due">
          <span class="sr-only">{{(deck.cards | statusFilter:1).length}} due</span>
        </div>
        <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{((deck.cards | statusFilter:0).length)/(deck.cards.length)*100}}%;" tooltip="{{(deck.cards | statusFilter:0).length}} new">
          <span class="sr-only">{{(deck.cards | statusFilter:0).length}} new</span>
        </div>
      </div>
    </div>

    <div ng-controller="CardCtrl">

      <div id="cardControl" class="statsBox" tabindex="0" ui-keyup="{'left right space enter':'keypressCallback($event)'}">

         <div class="btn-toolbar pull-right">
          <div class="btn-group animate-show" ng-show="isEditing" ng-cloak>
            <button type="button" class="btn btn-primary" ng-click="wrap('*','*')" tooltip="Italic"><i class="glyphicon glyphicon-italic"></i></button>
            <button type="button" class="btn btn-primary" ng-click="wrap('**','**')" tooltip="Bold"><i class="glyphicon glyphicon-bold"></i></button>
          </div>
          <div class="btn-group animate-show" ng-show="isEditing" ng-cloak>
            <button type="button" class="btn btn-primary" ng-click="wrap('\{','\}')" tooltip="Hide this seletion">{ }</button>
            <button type="button" class="btn btn-primary" ng-click="wrap('\{\{','\}\}')" tooltip="Cloze this selection">[..]</button>
          </div>
          <div class="btn-group">
            <button type="button" class="btn btn-primary" ng-click="add()"  tooltip="New card" ng-show="isOwner"><i class="glyphicon glyphicon-plus-sign" ></i> </button>
            <button type="button" class="btn btn-primary" ng-show="!isEditing && filteredCards.length" ng-click="edit()" tooltip="Edit"><i class="glyphicon glyphicon-pencil"></i> </button>
            <button type="button" class="btn btn-primary" ng-cloak ng-show="isEditing && filteredCards.length" ng-click="edit()" tooltip="Save"><i class="glyphicon glyphicon-save"></i> </button>
            <button type="button" class="btn btn-primary" ng-click="deleteCard()" ng-show="filteredCards.length && isOwner"  tooltip="Delete this card"><i class="glyphicon glyphicon-remove"></i ></button>
          </div>
        </div>

        <textarea id="edit" class="form-control cardEditor animate-show" rows="5" placeholder="Card contents" ng-model="card.text" card-blur="edit(false)" ng-show="isEditing && filteredCards.length > 0"  ng-cloak></textarea>

        <div id="review" ng-hide="!filteredCards.length" tabindex="0" ui-keyup="{'left right space enter up down':'keypressCallback($event)'}">
          <div class="card editable col-md-12" ng-class="{clozed: clozed}" ng-dblclick="edit(card)" ng-bind-html="card.text | formatCard"></div>
        </div>

        <div id="add" class="card editable col-md-12" ng-hide="filteredCards.length || !isOwner" ng-click="add()" ng-cloak>
            No cards
            <span ng-show="isOwner">
              <br />Click to add
              <p>
                <button type="button" class="btn btn-lg btn-link" tooltip="Add"><i class="glyphicon glyphicon-plus-sign"></i>  </button>
              </p>
            </span>
        </div>

        <div class="row">
          <div class="col-md-3 text-center">
            <div ng-cloak>
              <x-small>
              {{card | status | statusText}}
              <br />Due {{card.due | dateDays }}
              </x-small>
            </div>
          </div>

          <div class="col-md-6 text-center" >
            <div class="btn-group" >
              <button type="button" class="btn btn-lg btn-default" ng-click="up()" tooltip="Correct" ng-show="isOwner"><i class="glyphicon glyphicon-thumbs-up"></i> </button>
              <button type="button" class="btn btn-lg btn-default" ng-click="flip()" tooltip="Flip"><i class="glyphicon glyphicon-repeat"></i> </button>
              <button type="button" class="btn btn-lg btn-default" ng-click="down()" tooltip="Incorrect" ng-show="isOwner"><i class="glyphicon glyphicon-thumbs-down"></i> </button>
            </div>
          </div>

      </div>
      <div class="row"></div>

    </div>

    <div id="cardControl" class="statsBox" tabindex="0" ui-keyup="{'left right space enter':'keypressCallback($event)'}">

      <div class="row">
        <div class="col-md-3 text-center">
          <div class="btn-group">
            <a class="btn btn-lg btn-default" ng-click="prev()"  tooltip="Next"><span class="glyphicon glyphicon-chevron-left"></span></a>
            <a class="btn btn-lg btn-default" ng-click="next()" tooltip="Previous"><span class="glyphicon glyphicon-chevron-right"></span></a>
          </div>
        </div>
      </div>

      <div class="row"></div>

      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: {{(index+1)/(filteredCards.length)*100}}%;">
          <span class="sr-only">Card {{index+1}} / {{filteredCards.length}}</span>
        </div>
      </div>

    </div>

  </div>
</div>
